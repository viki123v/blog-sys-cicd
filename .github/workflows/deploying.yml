name: Deploying images 

on:
    push:
        branches: 
          - master
   
permissions:
    packages: write
    contents: write

jobs:
    fe-check:
        name: Frontend changed 
        uses: ./.github/workflows/checks.yml
        with: 
            fs-path: frontend/**    

    fe-deploy:
      needs: [ fe-check ]
      name: Deploy Frontend
      uses: ./.github/workflows/images.yml
      with: 
        name: fe 
        build-args: |
          NODE_VERSION=${{ vars.NODE_VERSION }},
          VITE_HOST=${{ vars.VITE_HOST }}
        dockerfile: frontend.Dockerfile    
        environment: prod

    be-check:
        name: Backend changed
        uses: ./.github/workflows/checks.yml
        with:
            fs-path: backend/**

    be-deploy:
      needs: [ be-check ]
      name: Deploy backend
      uses: ./.github/workflows/images.yml
      with: 
        name: be 
        dockerfile: backend.Dockerfile
        environment: prod